<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Awaken - v22 - 17SET25</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: flex-start;
      background: 
        linear-gradient(to right, rgba(244, 244, 244, 0.95) 60%, rgba(244, 244, 244, 0.2) 80%, transparent 100%),
        url('https://i.ibb.co/9mWwdssF/chatgpt-jogadoresquestionaveis.png') no-repeat right center fixed;
      background-size: auto 100%;
      color: #222;
    }
    .logo {
      position: fixed;
      top: 15px;
      left: 15px;
      width: 80px;
      z-index: 1000;
    }
    .content {
      background: rgba(255, 255, 255, 0.92);
      padding: 30px;
      border-radius: 10px;
      max-width: 55%;
      margin: 100px 30px 30px 30px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    h1, h2, h3 { color: #333; }
    input, button {
      padding: 8px;
      font-size: 16px;
      margin: 5px 0;
    }
    button {
      cursor: pointer;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
    }
    button:hover { background: #45a049; }
    .team {
      background: #fff;
      margin: 20px 0;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .team h2 { margin-top: 0; }
    .section {
      margin-top: 10px;
      padding: 10px;
      background: #f9f9f9;
      border-radius: 6px;
    }
    .section h3 { margin: 5px 0; font-size: 16px; }
    .player-card {
      background: #fafafa;
      margin: 5px 0;
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #ddd;
    }
    .player-card strong { font-size: 15px; }
    .counters {
      float: right;
      font-size: 14px;
      font-weight: bold;
    }
    .counters span { margin-left: 10px; }
    #darkModeBtn {
      position: fixed;
      top: 15px;
      right: 15px;
      background: #333;
      color: #fff;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      z-index: 1000;
    }
    #darkModeBtn:hover { background: #555; }
    body.dark { background: #121212; color: #f4f4f4; }
    body.dark .content { background: rgba(34,34,34,0.95); }
    body.dark .team { background: #1e1e1e; }
    body.dark .section { background: #2c2c2c; }
    body.dark .player-card { background: #333; border: 1px solid #555; }
    footer {
      margin: 30px;
      text-align: center;
      font-size: 14px;
      color: #555;
    }
    body.dark footer { color: #aaa; }
  </style>
</head>
<body>
  <button id="darkModeBtn">üåô Dark Mode</button>
  <div class="content">
    <h2>üîé Buscar por League ID</h2>
    <input type="text" id="leagueId" placeholder="Ex: 1234567890"><br>
    <button onclick="buscarPorLiga()">Verificar Liga</button>

    <h2>üîé Buscar por Nome de Usu√°rio</h2>
    <input type="text" id="username" placeholder="Ex: thiagomoura"><br>
    <button onclick="buscarPorUsuario()">Verificar Usu√°rio</button>

    <h2>üîé Buscar Franchise Players</h2>
    <input type="text" id="franchiseLeagueId" placeholder="League ID"><br>
    <input type="number" id="minFranchise" placeholder="M√≠nimo de Franchise Players"><br>
    <button onclick="buscarFranchisePlayers()">Verificar Franquias</button>

    <div style="margin-top:15px;">
      <button onclick="expandirTodos()">+</button>
      <button onclick="recolherTodos()">-</button>
      <button onclick="exportarWhatsapp()">Exportar para WhatsApp</button>
    </div>

    <div id="resultado"></div>
  </div>
  <footer>
    <p id="contador"></p>
    <p><a href="mailto:scrum.moura@gmail.com">Algo errado? Novas Ideias? Fale conosco.</a></p>
  </footer>

<script>
const teamsNFL = [
 "Arizona Cardinals","Atlanta Falcons","Baltimore Ravens","Buffalo Bills",
 "Carolina Panthers","Chicago Bears","Cincinnati Bengals","Cleveland Browns",
 "Dallas Cowboys","Denver Broncos","Detroit Lions","Green Bay Packers",
 "Houston Texans","Indianapolis Colts","Jacksonville Jaguars","Kansas City Chiefs",
 "Las Vegas Raiders","Los Angeles Chargers","Los Angeles Rams","Miami Dolphins",
 "Minnesota Vikings","New England Patriots","New Orleans Saints","New York Giants",
 "New York Jets","Philadelphia Eagles","Pittsburgh Steelers","San Francisco 49ers",
 "Seattle Seahawks","Tampa Bay Buccaneers","Tennessee Titans","Washington Commanders"
];

document.getElementById("darkModeBtn").addEventListener("click", () => {
  document.body.classList.toggle("dark");
  darkModeBtn.textContent = document.body.classList.contains("dark") ? "‚òÄÔ∏è Light Mode" : "üåô Dark Mode";
});

function contadorAcessos() {
  let acessos = localStorage.getItem("acessosSleeper") || 0;
  acessos++;
  localStorage.setItem("acessosSleeper", acessos);
  document.getElementById("contador").innerText = `GMs em a√ß√£o: ${acessos}`;
}
contadorAcessos();

function getStatusColor(status) {
  switch (status) {
    case "Out": return "#e53935";
    case "Questionable": return "#fb8c00";
    case "Doubtful": return "#ef6c00";
    case "IR": return "#8e24aa";
    case "Suspended": return "#616161";
    default: return "#1e88e5";
  }
}

// Expandir/Recolher
function expandirTodos() {
  document.querySelectorAll(".section").forEach(sec => sec.style.display="block");
}
function recolherTodos() {
  document.querySelectorAll(".section").forEach(sec => sec.style.display="none");
}

// Exportar resumo
function exportarWhatsapp() {
  let resumo = [];
  document.querySelectorAll(".team").forEach(team => {
    let titulo = team.querySelector("h2").innerText;
    if (team.querySelector(".alerta")) {
      resumo.push(`‚ö†Ô∏è ${titulo}: ${team.querySelector(".alerta").innerText}`);
    }
  });
  if (resumo.length === 0) resumo.push("‚úÖ Nenhum time em risco encontrado.");
  navigator.clipboard.writeText(resumo.join("\n"));
  alert("Resumo copiado para √°rea de transfer√™ncia!");
}

// Buscar por League ID
async function buscarPorLiga() {
  const leagueId = document.getElementById("leagueId").value.trim();
  const resultado = document.getElementById("resultado");
  resultado.innerHTML = "<p>Buscando jogadores...</p>";
  try {
    const users = await (await fetch(`https://api.sleeper.app/v1/league/${leagueId}/users`)).json();
    const rosters = await (await fetch(`https://api.sleeper.app/v1/league/${leagueId}/rosters`)).json();
    const players = await (await fetch("https://api.sleeper.app/v1/players/nfl")).json();

    const userMap = {};
    users.forEach(u => userMap[u.user_id] = { name: u.display_name, team: u.metadata?.team_name || "Sem nome" });

    resultado.innerHTML = "";
    rosters.sort((a,b)=>(userMap[a.owner_id]?.team||"").localeCompare(userMap[b.owner_id]?.team||""));
    rosters.forEach(r => {
      const owner = userMap[r.owner_id] || {};
      let lesionados = 0;
      const teamDiv = document.createElement("div");
      teamDiv.className="team";
      const section=document.createElement("div");
      section.className="section";

      (r.starters||[]).forEach(id=>{
        const p=players[id];
        if(p?.injury_status && p.injury_status!=="Healthy"){
          lesionados++;
          const card=document.createElement("div");
          card.className="player-card";
          card.innerHTML=`<strong>${p.full_name}</strong> (${p.position}, ${p.team||"FA"})<br>Status: <span style="color:${getStatusColor(p.injury_status)}">${p.injury_status}</span>`;
          section.appendChild(card);
        }
      });

      teamDiv.innerHTML=`<h2>${owner.team} ‚Äî ${owner.name}<span class="counters">Lesionados: ${lesionados}</span></h2>`;
      if(lesionados>0) section.style.display="block"; else section.style.display="none";
      teamDiv.appendChild(section);
      resultado.appendChild(teamDiv);
    });
  } catch(err){ resultado.innerHTML="<p style='color:red;'>Erro ao buscar liga.</p>"; }
}

// Buscar por Usuario
async function buscarPorUsuario() {
  const username=document.getElementById("username").value.trim();
  const resultado=document.getElementById("resultado");
  resultado.innerHTML="<p>Buscando...</p>";
  try{
    const user=await (await fetch(`https://api.sleeper.app/v1/user/${username}`)).json();
    const leagues=await (await fetch(`https://api.sleeper.app/v1/user/${user.user_id}/leagues/nfl/${new Date().getFullYear()}`)).json();
    const players=await (await fetch("https://api.sleeper.app/v1/players/nfl")).json();

    resultado.innerHTML="";
    for(const league of leagues){
      const rosters=await (await fetch(`https://api.sleeper.app/v1/league/${league.league_id}/rosters`)).json();
      const r=rosters.find(ro=>ro.owner_id===user.user_id);
      if(!r) continue;

      let lesionados=0;
      const teamDiv=document.createElement("div");
      teamDiv.className="team";
      const section=document.createElement("div");
      section.className="section";

      (r.starters||[]).forEach(id=>{
        const p=players[id];
        if(p?.injury_status && p.injury_status!=="Healthy"){
          lesionados++;
          const card=document.createElement("div");
          card.className="player-card";
          card.innerHTML=`<strong>${p.full_name}</strong> (${p.position}, ${p.team||"FA"})<br>Status: <span style="color:${getStatusColor(p.injury_status)}">${p.injury_status}</span>`;
          section.appendChild(card);
        }
      });

      teamDiv.innerHTML=`<h2>${league.name} ‚Äî ${user.display_name}<span class="counters">Lesionados: ${lesionados}</span></h2>`;
      if(lesionados>0) section.style.display="block"; else section.style.display="none";
      teamDiv.appendChild(section);
      resultado.appendChild(teamDiv);
    }
  }catch(err){ resultado.innerHTML="<p style='color:red;'>Erro ao buscar usu√°rio.</p>"; }
}

// Buscar Franchise Players
async function buscarFranchisePlayers(){
  const leagueId=document.getElementById("franchiseLeagueId").value.trim();
  const minFranchise=parseInt(document.getElementById("minFranchise").value.trim())||0;
  const resultado=document.getElementById("resultado");
  resultado.innerHTML="<p>Buscando franquias...</p>";
  try{
    const users=await (await fetch(`https://api.sleeper.app/v1/league/${leagueId}/users`)).json();
    const rosters=await (await fetch(`https://api.sleeper.app/v1/league/${leagueId}/rosters`)).json();
    const players=await (await fetch("https://api.sleeper.app/v1/players/nfl")).json();

    const userMap={}; users.forEach(u=>userMap[u.user_id]={name:u.display_name, team:u.metadata?.team_name||"Sem nome"});
    resultado.innerHTML="";

    rosters.sort((a,b)=>(userMap[a.owner_id]?.team||"").localeCompare(userMap[b.owner_id]?.team||""));
    rosters.forEach(r=>{
      const owner=userMap[r.owner_id]||{};
      let lesionados=0, franchiseCount=0;
      const section=document.createElement("div"); section.className="section";

      (r.starters||[]).forEach(id=>{
        const p=players[id];
        if(!p) return;
        const isFranchise=teamsNFL.some(t=>t.toLowerCase()=== (p.team||"").toLowerCase());
        if(isFranchise) franchiseCount++;
        if(p.injury_status && p.injury_status!=="Healthy"){
          lesionados++;
        }
        if(p.injury_status && p.injury_status!=="Healthy" || isFranchise){
          const card=document.createElement("div"); card.className="player-card";
          card.innerHTML=`<strong>${p.full_name}</strong> (${p.position}, ${p.team||"FA"})<br>Status: <span style="color:${getStatusColor(p.injury_status)}">${p.injury_status||"OK"}</span>`;
          section.appendChild(card);
        }
      });

      const teamDiv=document.createElement("div"); teamDiv.className="team";
      teamDiv.innerHTML=`<h2>${owner.team} ‚Äî ${owner.name}<span class="counters">Lesionados: ${lesionados} | Franchise: ${franchiseCount}</span></h2>`;
      if(franchiseCount<minFranchise){
        const falta=minFranchise-franchiseCount;
        section.innerHTML=`<p class="alerta" style="color:red;font-weight:bold;">Franquia em Risco ‚Äî faltam ${falta} jogadores</p>`+section.innerHTML;
      } else {
        section.innerHTML=`<p class="alerta" style="color:green;font-weight:bold;">Bom trabalho, tudo ok com a Franquia</p>`+section.innerHTML;
      }
      if(lesionados>0 || franchiseCount<minFranchise) section.style.display="block"; else section.style.display="none";
      teamDiv.appendChild(section); resultado.appendChild(teamDiv);
    });
  }catch(err){ resultado.innerHTML="<p style='color:red;'>Erro ao buscar franquias.</p>"; }
}
</script>
</body>
</html>
