<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Awaken - 18SET25 - v28 </title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: linear-gradient(to bottom, #f4f4f4, #e0e0e0);
      color: #333;
    }

    /* Layout em 3 colunas */
    .container {
      display: flex;
      height: 100vh;
    }

    .sidebar {
      width: 30%;
      background: #fafafa;
      padding: 15px;
      overflow-y: auto;
      border-right: 2px solid #ddd;
    }

    .main {
      width: 50%;
      padding: 15px;
      overflow-y: auto;
    }

    .tools {
      width: 20%;
      position: relative;
      background: rgba(255,255,255,0.8);
      background-image: url('https://i.ibb.co/9mWwdssF/chatgpt-jogadoresquestionaveis.png');
      background-repeat: no-repeat;
      background-position: right bottom;
      background-size: contain;
    }

    h1 {
      font-size: 20px;
      margin-bottom: 10px;
    }

    input, button {
      padding: 6px;
      margin: 5px 0;
      font-size: 14px;
      width: 95%;
    }

    button {
      cursor: pointer;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
    }
    button:hover { background: #45a049; }

    .team {
      background: #fff;
      margin: 10px 0;
      padding: 10px;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .team h2 { margin: 0 0 10px 0; }

    .section {
      margin-top: 10px;
      padding: 10px;
      background: #f9f9f9;
      border-radius: 6px;
    }

    .player-card {
      background: #fafafa;
      margin: 5px 0;
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #ddd;
    }

    .player-card.empty-slot {
      background: #ffe0e0;
      border: 1px solid #ff4444;
      color: #b71c1c;
      font-style: italic;
    }

    .counter-box {
      display: inline-block;
      background: #222;
      color: #fff;
      padding: 3px 8px;
      margin-left: 6px;
      border-radius: 4px;
      font-size: 12px;
    }

    /* Dark mode */
    body.dark {
      background: #121212;
      color: #eee;
    }
    body.dark .sidebar { background: #1e1e1e; }
    body.dark .main { background: #121212; }
    body.dark .team { background: #1e1e1e; border: 1px solid #444; }
    body.dark .section { background: #222; }
    body.dark .player-card { background: #2a2a2a; border: 1px solid #555; }
    body.dark .player-card.empty-slot { background: #4a1c1c; border: 1px solid #ff4444; }

    #darkModeBtn {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 6px 10px;
    }

    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #333;
      color: white;
      text-align: center;
      padding: 5px;
      font-size: 14px;
    }
    footer a {
      color: #4CAF50;
      margin-left: 10px;
    }
  </style>
</head>
<body>
  <button id="darkModeBtn">üåô Dark Mode</button>
  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
      <h1>Consultas</h1>
      
      <h3>1. Buscar por Liga</h3>
      <input type="text" id="leagueId" placeholder="League ID">
      <button onclick="buscarPorLiga()">Buscar</button>

      <h3>2. Buscar por Usu√°rio</h3>
      <input type="text" id="userName" placeholder="Nome de usu√°rio">
      <button onclick="buscarPorUsuario()">Buscar</button>

      <h3>3. Franchise Players</h3>
      <input type="text" id="leagueFranchiseId" placeholder="League ID">
      <input type="number" id="minFranchise" placeholder="M√≠n. Franchise Players">
      <button onclick="buscarFranchisePlayers()">Buscar</button>
      <button onclick="exportarWhatsapp()">Exportar WhatsApp</button>
    </div>

    <!-- Resultados -->
    <div class="main" id="resultado">
      <p>Resultados aparecer√£o aqui...</p>
    </div>

    <!-- Tools / Background -->
    <div class="tools"></div>
  </div>

  <footer>
    <span id="contadorAcessos"></span>
    <a href="mailto:suporte@fantasyhelper.com">Reportar problema</a>
  </footer>

<script>
  // Dark mode
  document.getElementById("darkModeBtn").addEventListener("click", () => {
    document.body.classList.toggle("dark");
  });

  // Contador de acessos
  let acessos = localStorage.getItem("acessos") || 0;
  acessos++;
  localStorage.setItem("acessos", acessos);
  document.getElementById("contadorAcessos").textContent = "Acessos: " + acessos;

  // Times NFL
  const nflTeams = [
    "Arizona Cardinals","Atlanta Falcons","Baltimore Ravens","Buffalo Bills","Carolina Panthers",
    "Chicago Bears","Cincinnati Bengals","Cleveland Browns","Dallas Cowboys","Denver Broncos",
    "Detroit Lions","Green Bay Packers","Houston Texans","Indianapolis Colts","Jacksonville Jaguars",
    "Kansas City Chiefs","Las Vegas Raiders","Los Angeles Chargers","Los Angeles Rams","Miami Dolphins",
    "Minnesota Vikings","New England Patriots","New Orleans Saints","New York Giants","New York Jets",
    "Philadelphia Eagles","Pittsburgh Steelers","San Francisco 49ers","Seattle Seahawks",
    "Tampa Bay Buccaneers","Tennessee Titans","Washington Commanders"
  ];

  function getStatusColor(status) {
    switch (status) {
      case "Out": return "#e53935";
      case "Questionable": return "#fb8c00";
      case "Doubtful": return "#ef6c00";
      case "IR": return "#8e24aa";
      case "Suspended": return "#616161";
      default: return "#1e88e5";
    }
  }

  async function buscarPorLiga() {
    const leagueId = document.getElementById("leagueId").value.trim();
    const resultado = document.getElementById("resultado");
    resultado.innerHTML = "<p>Buscando por liga...</p>";

    const [usersRes, rostersRes, playersRes] = await Promise.all([
      fetch(`https://api.sleeper.app/v1/league/${leagueId}/users`),
      fetch(`https://api.sleeper.app/v1/league/${leagueId}/rosters`),
      fetch("https://api.sleeper.app/v1/players/nfl")
    ]);

    const users = await usersRes.json();
    const rosters = await rostersRes.json();
    const players = await playersRes.json();

    const userMap = {};
    users.forEach(u => userMap[u.user_id] = u.display_name);

    resultado.innerHTML = "";

    rosters.forEach(r => {
      r.ownerName = userMap[r.owner_id] || "Sem dono";
      r.teamName = r.metadata?.team_name || "Sem nome definido";
    });
    rosters.sort((a,b)=>a.teamName.localeCompare(b.teamName));

    rosters.forEach(r => {
      let lesionados = 0;
      const teamDiv = document.createElement("div");
      teamDiv.className = "team";
      teamDiv.innerHTML = `<h2>${r.teamName} ‚Äî ${r.ownerName}
        <span class="counter-box">Lesionados: 0</span></h2>`;

      const startersSection = document.createElement("div");
      startersSection.className = "section";

      (r.starters||[]).forEach((id,idx)=>{
        if(!id){
          const pos = r.metadata?.starter_positions?.[idx] || "Posi√ß√£o";
          const card = document.createElement("div");
          card.className="player-card empty-slot";
          card.innerHTML = `<strong>‚ö† Posi√ß√£o vaga</strong><br>${pos} sem jogador.`;
          startersSection.appendChild(card);
        } else {
          const p = players[id];
          if(p){
            if(p.injury_status && p.injury_status!=="Healthy") lesionados++;
            const color = getStatusColor(p.injury_status);
            const card = document.createElement("div");
            card.className="player-card";
            card.innerHTML = `<strong>${p.full_name}</strong> (${p.position}, ${p.team||"FA"})<br>
              Status: <span style="color:${color}; font-weight:bold;">${p.injury_status||"Healthy"}</span>`;
            startersSection.appendChild(card);
          }
        }
      });
      teamDiv.querySelector(".counter-box").textContent = "Lesionados: "+lesionados;
      teamDiv.appendChild(startersSection);
      resultado.appendChild(teamDiv);
    });
  }

  async function buscarPorUsuario() {
    const userName = document.getElementById("userName").value.trim();
    const resultado = document.getElementById("resultado");
    resultado.innerHTML = "<p>Buscando por usu√°rio...</p>";

    const userRes = await fetch(`https://api.sleeper.app/v1/user/${userName}`);
    const user = await userRes.json();

    const leaguesRes = await fetch(`https://api.sleeper.app/v1/user/${user.user_id}/leagues/nfl/2025`);
    const leagues = await leaguesRes.json();

    const playersRes = await fetch("https://api.sleeper.app/v1/players/nfl");
    const players = await playersRes.json();

    resultado.innerHTML = "";

    for(const league of leagues){
      const rostersRes = await fetch(`https://api.sleeper.app/v1/league/${league.league_id}/rosters`);
      const rosters = await rostersRes.json();
      const roster = rosters.find(r=>r.owner_id===user.user_id);
      if(!roster) continue;

      let lesionados=0;
      const teamDiv = document.createElement("div");
      teamDiv.className="team";
      teamDiv.innerHTML = `<h2>${league.name} (ID: ${league.league_id})
        <span class="counter-box">Lesionados: 0</span></h2>`;

      const startersSection=document.createElement("div");
      startersSection.className="section";

      (roster.starters||[]).forEach((id,idx)=>{
        if(!id){
          const pos = roster.metadata?.starter_positions?.[idx] || "Posi√ß√£o";
          const card=document.createElement("div");
          card.className="player-card empty-slot";
          card.innerHTML=`<strong>‚ö† Posi√ß√£o vaga</strong><br>${pos} sem jogador.`;
          startersSection.appendChild(card);
        } else {
          const p=players[id];
          if(p){
            if(p.injury_status && p.injury_status!=="Healthy") lesionados++;
            const color=getStatusColor(p.injury_status);
            const card=document.createElement("div");
            card.className="player-card";
            card.innerHTML=`<strong>${p.full_name}</strong> (${p.position}, ${p.team||"FA"})<br>
              Status: <span style="color:${color}; font-weight:bold;">${p.injury_status||"Healthy"}</span>`;
            startersSection.appendChild(card);
          }
        }
      });
      teamDiv.querySelector(".counter-box").textContent="Lesionados: "+lesionados;
      teamDiv.appendChild(startersSection);
      resultado.appendChild(teamDiv);
    }
  }

  async function buscarFranchisePlayers(){
    const leagueId=document.getElementById("leagueFranchiseId").value.trim();
    const minFranchise=parseInt(document.getElementById("minFranchise").value)||0;
    const resultado=document.getElementById("resultado");
    resultado.innerHTML="<p>Buscando franchise players...</p>";

    const [usersRes, rostersRes, playersRes]=await Promise.all([
      fetch(`https://api.sleeper.app/v1/league/${leagueId}/users`),
      fetch(`https://api.sleeper.app/v1/league/${leagueId}/rosters`),
      fetch("https://api.sleeper.app/v1/players/nfl")
    ]);

    const users=await usersRes.json();
    const rosters=await rostersRes.json();
    const players=await playersRes.json();

    const userMap={};
    users.forEach(u=>userMap[u.user_id]=u.display_name);

    resultado.innerHTML="";

    rosters.forEach(r=>{
      r.ownerName=userMap[r.owner_id]||"Sem dono";
      r.teamName=r.metadata?.team_name||"Sem nome definido";
    });
    rosters.sort((a,b)=>a.teamName.localeCompare(b.teamName));

    rosters.forEach(r=>{
      let lesionados=0;
      let franchiseCount=0;
      const teamDiv=document.createElement("div");
      teamDiv.className="team";
      teamDiv.innerHTML=`<h2>${r.teamName} ‚Äî ${r.ownerName}
        <span class="counter-box">Lesionados: 0</span>
        <span class="counter-box">Franchise: 0</span></h2>`;

      const startersSection=document.createElement("div");
      startersSection.className="section";

      (r.starters||[]).forEach((id,idx)=>{
        if(!id){
          const pos = r.metadata?.starter_positions?.[idx] || "Posi√ß√£o";
          const card=document.createElement("div");
          card.className="player-card empty-slot";
          card.innerHTML=`<strong>‚ö† Posi√ß√£o vaga</strong><br>${pos} sem jogador.`;
          startersSection.appendChild(card);
        } else {
          const p=players[id];
          if(p){
            if(p.injury_status && p.injury_status!=="Healthy") lesionados++;
            if(p.is_franchise_player) franchiseCount++;
            const color=getStatusColor(p.injury_status);
            const card=document.createElement("div");
            card.className="player-card";
            card.innerHTML=`<strong>${p.full_name}</strong> (${p.position}, ${p.team||"FA"})<br>
              Status: <span style="color:${color}; font-weight:bold;">${p.injury_status||"Healthy"}</span>`;
            startersSection.appendChild(card);
          }
        }
      });

      teamDiv.querySelectorAll(".counter-box")[0].textContent="Lesionados: "+lesionados;
      teamDiv.querySelectorAll(".counter-box")[1].textContent="Franchise: "+franchiseCount;

      if(franchiseCount>=minFranchise){
        teamDiv.appendChild(startersSection);
        resultado.appendChild(teamDiv);
      }
    });
  }

  function exportarWhatsapp(){
    const resultado=document.getElementById("resultado").innerText;
    const text=encodeURIComponent("Resumo Franchise Players:\n\n"+resultado);
    window.open("https://wa.me/?text="+text,"_blank");
  }
</script>
</body>
</html>
