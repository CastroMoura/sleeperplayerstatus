<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Status Jogadores - Sleeper - v.12</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(to right, #101820, #203040);
      color: #eee;
      min-height: 100vh;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #0d1117;
      padding: 10px 20px;
      border-bottom: 2px solid #222;
    }
    header img {
      height: 40px;
    }
    header button {
      padding: 6px 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background: #4CAF50;
      color: white;
    }
    header button:hover {
      background: #45a049;
    }
    .content {
      padding: 20px;
      max-width: 1200px;
    }
    h1 {
      margin-top: 0;
      font-size: 22px;
      color: #fff;
    }
    label, input, button {
      font-size: 14px;
    }
    input {
      padding: 5px;
      margin: 5px 0;
      border-radius: 4px;
      border: 1px solid #555;
    }
    button {
      padding: 6px 12px;
      margin: 5px 0;
      border-radius: 5px;
      border: none;
      cursor: pointer;
    }
    button:hover {
      opacity: 0.9;
    }
    .team {
      background: rgba(255,255,255,0.08);
      margin: 20px 0;
      padding: 15px;
      border-radius: 8px;
    }
    .team h2 {
      margin: 0 0 10px 0;
      color: #ffcc00;
    }
    .team input {
      margin-left: 10px;
      background: #222;
      color: #fff;
      border: 1px solid #666;
    }
    .section {
      margin-top: 10px;
      padding: 10px;
      background: rgba(0,0,0,0.3);
      border-radius: 6px;
    }
    .section h3 {
      margin: 5px 0;
      font-size: 16px;
      color: #ccc;
    }
    .player-card {
      background: rgba(255,255,255,0.05);
      margin: 5px 0;
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #444;
    }
    footer {
      margin-top: 40px;
      padding: 15px;
      text-align: center;
      font-size: 14px;
      background: #0d1117;
      border-top: 2px solid #222;
      color: #aaa;
    }
  </style>
</head>
<body>
  <header>
    <img src="https://e7.pngegg.com/pngimages/615/707/png-clipart-nfl-logo-nfl-national-football-league-playoffs-united-states-washington-redskins-oakland-raiders-nfl-text-sport.png" alt="NFL Logo">
    <button onclick="toggleDarkMode()">üåô Dark Mode</button>
  </header>

  <div class="content">
    <h1>Status dos Jogadores (Sleeper)</h1>

    <label for="leagueId">Informe o League ID:</label><br>
    <input type="text" id="leagueId" placeholder="Ex: 1234567890"><br>
    <button onclick="buscarPorLiga()">Buscar por Liga</button>

    <br><br>

    <label for="username">Informe o nome do usu√°rio (Sleeper):</label><br>
    <input type="text" id="username" placeholder="Ex: thiago"><br>
    <button onclick="buscarPorUsuario()">Buscar por Usu√°rio</button>

    <div id="resultado"></div>
  </div>

  <footer>
    <p id="contador"></p>
  </footer>

<script>
  // Contador de acessos
  let acessos = localStorage.getItem("acessos") || 0;
  acessos++;
  localStorage.setItem("acessos", acessos);
  document.getElementById("contador").innerText = "Total de acessos: " + acessos;

  // Dark mode
  function toggleDarkMode() {
    document.body.classList.toggle("dark");
  }

  // Fun√ß√£o para salvar nome manual no localStorage
  function salvarNomeTime(key, value) {
    let timesSalvos = JSON.parse(localStorage.getItem("timesSalvos") || "{}");
    timesSalvos[key] = value;
    localStorage.setItem("timesSalvos", JSON.stringify(timesSalvos));
  }

  // Fun√ß√£o para recuperar nome manual salvo
  function carregarNomeTime(key) {
    let timesSalvos = JSON.parse(localStorage.getItem("timesSalvos") || "{}");
    return timesSalvos[key] || "";
  }

  async function buscarPorLiga() {
    const leagueId = document.getElementById("leagueId").value.trim();
    const resultado = document.getElementById("resultado");
    resultado.innerHTML = "<p>Buscando jogadores...</p>";

    try {
      const usersRes = await fetch(`https://api.sleeper.app/v1/league/${leagueId}/users`);
      const users = await usersRes.json();
      const userMap = {};
      users.forEach(u => {
        userMap[u.user_id] = u.display_name;
      });

      const rostersRes = await fetch(`https://api.sleeper.app/v1/league/${leagueId}/rosters`);
      const rosters = await rostersRes.json();

      const playersRes = await fetch("https://api.sleeper.app/v1/players/nfl");
      const players = await playersRes.json();

      resultado.innerHTML = "";

      rosters.forEach(r => {
        const ownerName = userMap[r.owner_id] || "Time sem dono";
        const teamKey = `${leagueId}_${r.roster_id}`;
        const teamNameSalvo = carregarNomeTime(teamKey);
        const teamName = teamNameSalvo || r.metadata?.team_name || "";

        const teamDiv = document.createElement("div");
        teamDiv.className = "team";

        teamDiv.innerHTML = `
          <h2>${ownerName} <small>(${teamName || "Digite o nome do time"})</small>
            <input type="text" value="${teamName}" placeholder="Nome do time"
              oninput="this.previousElementSibling.innerText='('+this.value+')'; salvarNomeTime('${teamKey}', this.value)">
          </h2>
        `;

        const startersSection = document.createElement("div");
        startersSection.className = "section";
        startersSection.innerHTML = "<h3>Titulares</h3>";

        let count = 0;
        (r.starters || []).forEach(id => {
          const p = players[id];
          if (p?.injury_status && p.injury_status !== "Healthy") {
            count++;
            const playerDiv = document.createElement("div");
            playerDiv.className = "player-card";
            playerDiv.innerText = `${p.full_name} ‚Äî ${p.injury_status}`;
            startersSection.appendChild(playerDiv);
          }
        });

        if (count > 0) {
          teamDiv.querySelector("h2").innerHTML += ` [${count}]`;
          teamDiv.appendChild(startersSection);
        }

        resultado.appendChild(teamDiv);
      });
    } catch (e) {
      resultado.innerHTML = "<p>Erro ao buscar dados.</p>";
      console.error(e);
    }
  }

  async function buscarPorUsuario() {
    const username = document.getElementById("username").value.trim();
    const resultado = document.getElementById("resultado");
    resultado.innerHTML = "<p>Buscando ligas do usu√°rio...</p>";

    try {
      const userRes = await fetch(`https://api.sleeper.app/v1/user/${username}`);
      const user = await userRes.json();
      if (!user?.user_id) {
        resultado.innerHTML = "<p>Usu√°rio n√£o encontrado.</p>";
        return;
      }

      const leaguesRes = await fetch(`https://api.sleeper.app/v1/user/${user.user_id}/leagues/nfl/2024`);
      const leagues = await leaguesRes.json();

      resultado.innerHTML = "";
      for (const league of leagues) {
        if (league.sport !== "nfl" || league.league_type !== "fantasy") continue;

        const rostersRes = await fetch(`https://api.sleeper.app/v1/league/${league.league_id}/rosters`);
        const rosters = await rostersRes.json();

        const playersRes = await fetch("https://api.sleeper.app/v1/players/nfl");
        const players = await playersRes.json();

        rosters.forEach(r => {
          if (r.owner_id !== user.user_id) return;

          const teamKey = `${league.league_id}_${r.roster_id}`;
          const teamNameSalvo = carregarNomeTime(teamKey);

          const teamDiv = document.createElement("div");
          teamDiv.className = "team";
          teamDiv.innerHTML = `
            <h2>${league.name} ‚Äî ${user.display_name} 
              <small>(${teamNameSalvo || "Digite o nome do time"})</small>
              <input type="text" value="${teamNameSalvo}" placeholder="Nome do time"
                oninput="this.previousElementSibling.innerText='('+this.value+')'; salvarNomeTime('${teamKey}', this.value)">
            </h2>
          `;

          const startersSection = document.createElement("div");
          startersSection.className = "section";
          startersSection.innerHTML = "<h3>Titulares</h3>";

          let count = 0;
          (r.starters || []).forEach(id => {
            const p = players[id];
            if (p?.injury_status && p.injury_status !== "Healthy") {
              count++;
              const playerDiv = document.createElement("div");
              playerDiv.className = "player-card";
              playerDiv.innerText = `${p.full_name} ‚Äî ${p.injury_status}`;
              startersSection.appendChild(playerDiv);
            }
          });

          if (count > 0) {
            teamDiv.querySelector("h2").innerHTML += ` [${count}]`;
            teamDiv.appendChild(startersSection);
          }

          resultado.appendChild(teamDiv);
        });
      }
    } catch (e) {
      resultado.innerHTML = "<p>Erro ao buscar dados.</p>";
      console.error(e);
    }
  }
</script>
</body>
</html>
